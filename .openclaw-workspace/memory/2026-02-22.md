# 2026-02-22 — Daily Notes

## Mac Mini Migration Plan — Major Review Session

### Context

- Continued from Feb 17 work on Mac Mini M4 migration plan
- Session was near compaction multiple times — extensive iterative review cycle
- Plan evolved from v3.1 → v4 → v4.1 → v4.2 through multiple review passes

### Key Decisions & Findings

**v3 → v3.1 fixes:**

- `brew install node@22` is keg-only → use `brew install node` (per OpenClaw docs)
- `launchctl load` deprecated → `launchctl bootstrap gui/$(id -u)`
- `displaysleep 0` → `displaysleep 10` (monitor attached)
- Added SSH + Screen Sharing, Tailscale remote management, Control UI access from PC/phone

**v3.1 → v4 additions:**

- FileVault disk encryption (critical for physical theft protection)
- SSH key-only auth (disable password auth)
- Auto-update strategy with daily npm update + automatic rollback on health check failure
- Layer separation diagram (npm package vs ~/.openclaw/ — updates never touch config/workspace)
- `brew pin node` (not HOMEBREW_NO_AUTO_UPDATE — that was wrong, auto-update only refreshes formula list, doesn't upgrade packages)
- Disaster recovery procedure (Time Machine ~1hr, from scratch ~3hr)
- Table of contents with time estimates (~3.5hr total)

**v4 → v4.1 critical bugs found:**

- `set -euo pipefail` broke BOTH scripts — set -e kills script before $? can be read on non-zero exit. Token refresh was COMPLETELY non-functional. Fixed: `set -uo pipefail`
- FileVault contradicts automatic login — macOS disables auto-login when FileVault is on. Removed "enable automatic login" instruction.
- Checklist had `brew pin node` before `brew install node`
- Auto-update version comparison: `openclaw --version` might not match `npm view` format. Fixed: use `npm list -g --json | jq`
- `UsePAM no` too aggressive for macOS — removed, PasswordAuthentication+KbdInteractive is sufficient
- `gateway-start-delay.sh` was created but never wired into launchd — removed, OpenClaw handles reconnection natively

**v4.1 → v4.2 issues found:**

- UptimeRobot can't reach Tailscale IPs (100.x.y.z only reachable from tailnet) → replaced with Healthchecks.io dead man's switch
- VNC at FileVault pre-boot screen is IMPOSSIBLE (macOS not loaded yet, no networking) → physical keyboard required
- Token refresh was weekly but token lifetime unknown → changed to daily (exits instantly if healthy, near-zero cost)
- Phase ordering: SSH hardening was before Tailscale setup → swapped (Tailscale first = safety net)
- Missing `~/.openclaw/credentials/` from backup (OpenClaw docs explicitly list it)
- macOS auto-update too broad → keep RSR (Rapid Security Responses) ON
- Auto-update: unknown version guard (skip if can't determine current version)
- Added Xcode CLT, reference copies of scripts in workspace git

**Still pending in v4.2 (identified but not yet fixed):**

- sshd_config formatting: `# PasswordAuthentication no` in bash block looks like lines should include `#` prefix, but that makes them comments in sshd_config (no effect). SSH hardening silently fails.
- FileVault troubleshooting row still says "local VNC" — contradicts Phase 2.3
- Phase 5.1 "stop old instance" is vague (no specific command)
- Persistent gateway log has no rotation mentioned
- Auth backup via Telegram contains secrets (should note to delete after download)

### Technical Notes from OpenClaw Docs

- Official install: `brew install node` then `npm install -g openclaw@latest` or installer script
- `openclaw models auth setup-token` prompts for token value; `paste-token` accepts from automation
- Gateway service label: `bot.molt.gateway` (legacy `com.openclaw.*` still works)
- Config hot-reload works for most settings (not gateway server settings)
- File logs at `/tmp/openclaw/openclaw-YYYY-MM-DD.log` (daily rolling, cleared on reboot)
- `openclaw doctor --yes` auto-accepts safe fixes
- Tailscale integration native: serve/funnel modes, identity auth via headers

### v4.2 → v4.2.1 (final polish)

- sshd_config formatting fixed — config lines were inside bash comments with `#` prefix, would silently fail to harden SSH
- FileVault troubleshooting row: "local VNC" → "Physical monitor + keyboard"
- Phase 5.1: added specific `openclaw gateway stop` command for old CC container
- Persistent log rotation via macOS newsyslog
- Auth backup security note (delete from Telegram after download)
- Tar extraction path hint (~/Downloads/)

### Files Modified

- `/root/.openclaw/workspace/guides/mac-mini-full-plan.md` — v3.1 through v4.2.1
- Sent to Kamil via Telegram: v3.1, v4, v4.1, v4.2, v4.2.1 as document attachments

### Kamil's Review Style

- Asks for fixes, then asks for review, then asks to question everything — iterative hardening
- Values security, best practices, and correctness over speed
- Caught the `brew pin` vs `HOMEBREW_NO_AUTO_UPDATE` issue himself — good instincts
